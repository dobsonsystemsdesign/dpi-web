on:
  pull_request:
    branches:
    - main
  push:
    branches:
      - github-actions-updates
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v1
    - uses: actions/setup-node@v1 #this installs node and npm for us
      with:
        node-version: '10.x'
    - uses: actions/cache@v1
      with:
        path: ~/.npm
        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-node-
    - name: Build
      run: |
        npm install
        npm run-script deploy
    - name: SSH Push
      # You may pin to the exact commit or the version.
      # uses: ErenKrt/ssh-push@cad78a18fe254e919c7232134c73e6d02773cbae
      uses: ErenKrt/ssh-push@1.0
      with:
        # IP Address of remote host
        HOST: 159.223.126.194
        # Port of SSH Protocol
        PORT: 22
        # Username of SSH user
        USERNAME: jdobson
        # SSH Private Key
        PRIVATE_KEY: ${{secrets.DO_PRIV_KEY}}
        # Folder to be transferred
        SOURCE: /dist/dpi-web
        # Exlude paths or file in source folder with glob features
        #EXCLUDE: # optional
        # Using zip for stability at transfer, file name of zip
        #ZIPNAME: # optional, default is build.zip
        # Remote host path to copy zip
        OUTDIR: /var/www/dpi-web
        # Execute commands after transfer source file
        #SCRIPTS: # optional
